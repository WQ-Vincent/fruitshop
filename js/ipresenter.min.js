/**
 * jQuery-Plugin "iPresenter"
 * 
 * @version: 2.0, 24.05.2012
 * @version: 1.1, 19.04.2012
 * @version: 1.0, 21.03.2012
 * 
 * @author: Hemn Chawroka
 *          http://www.iprodev.com/
 * 
 */
(function(b){b.fn.iPresenter=function(a){var a=jQuery.extend({easing:"ease-in-out",autoPlay:!0,replay:!0,animSpeed:1E3,pauseTime:5E3,directionNav:!0,directionNavHoverOpacity:0.6,controlNav:!1,controlNavNextPrev:!0,controlNavHoverOpacity:0.6,controlNavThumbs:!1,controlNavTooltip:!0,keyboardNav:!0,touchNav:!0,pauseOnHover:!1,itemsOpacity:0.4,nextLabel:"Next",previousLabel:"Previous",playLabel:"Play",pauseLabel:"Pause",randomStart:!1,startStep:1,timer:"Pie",timerBg:"#333",timerColor:"#FFF",timerOpacity:0.2,
timerDiameter:35,timerPadding:4,timerStroke:3,timerBarStroke:1,timerBarStrokeColor:"#FFF",timerBarStrokeStyle:"solid",timerBarStrokeRadius:4,timerPosition:"top-right",onPlay:function(){},onPause:function(){},onAfterLoad:function(){},onBeforeChange:function(){},onAfterChange:function(){},onSlideshowEnd:function(){},onLastStep:function(){}},a),l=b(this),d=b(l[0].parentNode),g=b(".step",l);disableSelection(d[0]);var m=g.length,j=[],o=null,q=!1,n=1,P=d.width(),Q=d.height(),h="ease-in-out",t=!1,R={color:a.timerColor,
size:parseInt(a.timerStroke),diameter:parseInt(a.timerDiameter),radius:parseInt(a.timerDiameter-2*a.timerPadding-a.timerStroke)},S={color:a.timerBg,size:parseInt(a.timerStroke+2*a.timerPadding),diameter:parseInt(a.timerDiameter),radius:parseInt(a.timerDiameter-(a.timerStroke+2*a.timerPadding))},T={color:a.timerBg,diameter:parseInt(a.timerDiameter),radius:parseInt(a.timerDiameter-1)},U={color:a.timerColor,diameter:parseInt(a.timerDiameter),radius:parseInt(a.timerDiameter-2*a.timerPadding-1)},B=a.pauseTime,
i=0;b("img",l).each(function(){var a=b(this);j.push(a.attr("src"));a.data("thumbnail")&&j.push(a.data("thumbnail"))});g.each(function(){b(this).data("thumbnail")&&j.push(b(this).data("thumbnail"))});a.startStep=a.randomStart?Math.floor(Math.random()*m):a.startStep;a.startStep=0<a.startStep&&a.startStep>=m?m:a.startStep;var n=a.startStep,B=g.eq(n-1).data("pausetime")?g.eq(n-1).data("pausetime"):a.pauseTime,G=function(){for(var a=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective",
"msPerspective"],b=0,e=!1,d=document.createElement("form");a[b];){if(a[b]in d.style){e=!0;break}b++}return e},u=function(a){return G()?" translate3d("+a.x+"px,"+a.y+"px,"+a.z+"px) ":" translate("+a.x+"px,"+a.y+"px) "},v=function(a,b){var e=" rotateX("+a.x+"deg) ",d=" rotateY("+a.y+"deg) ",c=" rotateZ("+a.z+"deg) ";return G()?b?c+d+e:e+d+c:" rotate("+a.z+"deg) "},w=function(a){return" scale("+a+") "},H=function(a){return{translate:{x:a.data("x")||0,y:a.data("y")||0,z:a.data("z")||0},rotate:{x:a.data("rotatex")||
0,y:a.data("rotatey")||0,z:a.data("rotatez")||a.data("rotate")||0},scale:a.data("scale")||1}},C=function(a){a=b.trim(a);switch(a){case "linear":a="cubic-bezier(0.250, 0.250, 0.750, 0.750)";break;case "ease":a="cubic-bezier(0.250, 0.100, 0.250, 1.000)";break;case "ease-in":a="cubic-bezier(0.420, 0.000, 1.000, 1.000)";break;case "ease-out":a="cubic-bezier(0.000, 0.000, 0.580, 1.000)";break;case "ease-in-out":a="cubic-bezier(0.420, 0.000, 0.580, 1.000)";break;case "ease-out-in":a="cubic-bezier(0.000, 0.420, 1.000, 0.580)";
break;case "easeInQuad":a="cubic-bezier(0.550, 0.085, 0.680, 0.530)";break;case "easeInCubic":a="cubic-bezier(0.550, 0.055, 0.675, 0.190)";break;case "easeInQuart":a="cubic-bezier(0.895, 0.030, 0.685, 0.220)";break;case "easeInQuint":a="cubic-bezier(0.755, 0.050, 0.855, 0.060)";break;case "easeInSine":a="cubic-bezier(0.470, 0.000, 0.745, 0.715)";break;case "easeInExpo":a="cubic-bezier(0.950, 0.050, 0.795, 0.035)";break;case "easeInCirc":a="cubic-bezier(0.600, 0.040, 0.980, 0.335)";break;case "easeInBack":a=
"cubic-bezier(0.600, -0.280, 0.735, 0.045)";break;case "easeOutQuad":a="cubic-bezier(0.250, 0.460, 0.450, 0.940)";break;case "easeOutCubic":a="cubic-bezier(0.215, 0.610, 0.355, 1.000)";break;case "easeOutQuart":a="cubic-bezier(0.165, 0.840, 0.440, 1.000)";break;case "easeOutQuint":a="cubic-bezier(0.230, 1.000, 0.320, 1.000)";break;case "easeOutSine":a="cubic-bezier(0.390, 0.575, 0.565, 1.000)";break;case "easeOutExpo":a="cubic-bezier(0.190, 1.000, 0.220, 1.000)";break;case "easeOutCirc":a="cubic-bezier(0.075, 0.820, 0.165, 1.000)";
break;case "easeOutBack":a="cubic-bezier(0.175, 0.885, 0.320, 1.275)";break;case "easeInOutQuad":a="cubic-bezier(0.455, 0.030, 0.515, 0.955)";break;case "easeInOutCubic":a="cubic-bezier(0.645, 0.045, 0.355, 1.000)";break;case "easeInOutQuart":a="cubic-bezier(0.770, 0.000, 0.175, 1.000)";break;case "easeInOutQuint":a="cubic-bezier(0.860, 0.000, 0.070, 1.000)";break;case "easeInOutSine":a="cubic-bezier(0.445, 0.050, 0.550, 0.950)";break;case "easeInOutExpo":a="cubic-bezier(1.000, 0.000, 0.000, 1.000)";
break;case "easeInOutCirc":a="cubic-bezier(0.785, 0.135, 0.150, 0.860)";break;case "easeInOutBack":a="cubic-bezier(0.680, 0, 0.265, 1)"}return a},I=function(a,b,e){var d=-90*Math.PI/180,b=(b-90)*Math.PI/180,c=Math.round(e.diameter/2);a.beginPath();a.arc(c,c,e.radius/2,d,b,!1);a.lineWidth=e.size;a.strokeStyle=e.color;a.lineCap="round";a.stroke();a.closePath()},J=function(a,b,e){var d=-90*Math.PI/180,b=(b-90)*Math.PI/180,c=Math.round(e.diameter/2);a.beginPath();a.moveTo(c,c);a.arc(c,c,e.radius/2,d,
b,!1);a.fillStyle=e.color;a.fill();a.closePath()},D=function(b){b&&b.clearRect(0,0,a.timerDiameter,a.timerDiameter);"360bar"==a.timer.toLowerCase()?(I(b,360,S),I(b,i,R)):"pie"==a.timer.toLowerCase()?(J(b,360,T),J(b,i,U)):K.css({width:100*(i/360)+"%"});i+=2},h=C(a.easing),L={position:"absolute","-webkit-transform-origin":"0% 0%","-webkit-transition":"all 0s "+h,"-webkit-transform-style":"preserve-3d","-webkit-perspective":"1000px","-moz-transform-origin":"0% 0%","-moz-transition":"all 0s "+h,"-moz-transform-style":"preserve-3d",
"-moz-perspective":"1000px","-o-transform-origin":"0% 0%","-o-transition":"all 0s "+h,"-o-transform-style":"preserve-3d","-o-perspective":"1000px","-ms-transform-origin":"0% 0%","-ms-transition":"all 0s "+h,"-ms-transform-style":"preserve-3d","-ms-perspective":"1000px","transform-origin":"0% 0%",transition:"all 0s "+h,"transform-style":"preserve-3d",perspective:"1000px",top:"50%",left:"50%"};l.append('<div id="content"></div><div id="preloader"><div></div></div>');d.append('<canvas id="ipresenter-timer" width="'+
a.timerDiameter+'" height="'+a.timerDiameter+'"><div></div></canvas>');a.directionNav&&d.append("<a class='ipresenter_stepsNav' title='"+a.nextLabel+"' id='ipresenter_nextStep'></a><a class='ipresenter_stepsNav' title='"+a.previousLabel+"' id='ipresenter_prevStep'></a>");if(a.controlNav){var c='<div class="ipresenter-controlNav">';a.controlNavNextPrev&&(c+='<a class="ipresenter-controlPrevNav" title="'+a.previousLabel+'">'+a.previousLabel+"</a>");for(var c=c+'<div class="ipresenter-items"><ul>',f=
0;f<m;f++){var p=g.eq(f);a.controlNavThumbs?(p=p.data("thumbnail"),c+='<li><a class="ipresenter-control" rel="'+(f+1)+'"><img src="'+p+'" /></a></li>'):(p=p.data("thumbnail"),c+='<li><a class="ipresenter-control" rel="'+(f+1)+'">'+(f+1)+"</a>",a.controlNavTooltip&&(c+='<div class="ipresenter-tooltip"><div><img src="'+p+'" /></div></div>'),c+="</li>")}c+="</ul></div>";a.controlNavNextPrev&&(c+='<a class="ipresenter-controlNextNav" title="'+a.nextLabel+'">'+a.nextLabel+"</a>");d.append(c+"</div>");
b(".ipresenter-controlNav a.ipresenter-control:eq("+(n-1)+")",d).addClass("active")}"bar"==a.timer.toLowerCase()&&b("#ipresenter-timer").replaceWith('<div id="ipresenter-timer">'+b("#ipresenter-timer").html()+"</div>");var E=b("#content",l),V=b("#preloader",l),M=b("#preloader div",l),k=b("#ipresenter-timer",d),K=b("div",k);ctx="bar"!=a.timer.toLowerCase()?k[0].getContext("2d"):null;g.appendTo(E);b("a.ipresenter_stepsNav").hide();k.css({cursor:"pointer","z-index":"1000",position:"absolute",opacity:a.timerOpacity}).hide();
"bar"==a.timer.toLowerCase()&&(k.css({opacity:a.timerOpacity,borderRadius:a.timerBarStrokeRadius+"px",width:a.timerDiameter,height:a.timerStroke,border:a.timerBarStroke+"px "+a.timerBarStrokeColor+" "+a.timerBarStrokeStyle,padding:a.timerPadding,background:a.timerBg}),K.css({borderRadius:a.timerBarStrokeRadius-1+"px",width:0,height:a.timerStroke,background:a.timerColor,"float":"left"}));c=a.timerPosition.toLowerCase().split("-");for(f=0;f<c.length;f++)"top"==c[f]&&k.css({top:"10px",bottom:""}),"middle"==
c[f]&&k.css({top:Q/2-a.timerDiameter/2+"px",bottom:""}),"bottom"==c[f]&&k.css({bottom:"10px",top:""}),"left"==c[f]&&k.css({left:"10px",right:""}),"center"==c[f]&&k.css({left:P/2-a.timerDiameter/2+"px",right:""}),"right"==c[f]&&k.css({right:"10px",left:""});l.css(L);E.css(L);g.each(function(d){var c=b(this),e=H(c),e={position:"absolute","-webkit-transform":"translate(-50%,-50%)"+u(e.translate)+v(e.rotate)+w(e.scale)+"","-webkit-transform-style":"preserve-3d","-moz-transform":"translate(-50%,-50%)"+
u(e.translate)+v(e.rotate)+w(e.scale)+"","-moz-transform-style":"preserve-3d","-o-transform":"translate(-50%,-50%)"+u(e.translate)+v(e.rotate)+w(e.scale)+"","-o-transform-style":"preserve-3d","-ms-transform":"translate(-50%,-50%)"+u(e.translate)+v(e.rotate)+w(e.scale)+"","-ms-transform-style":"preserve-3d",transform:"translate(-50%,-50%)"+u(e.translate)+v(e.rotate)+w(e.scale)+"","transform-style":"preserve-3d",opacity:a.itemsOpacity};c.css(e).attr("step",d+1);d==0&&c.css({opacity:1})}).hide();var W=
function(){t=false;k.animate({opacity:a.timerOpacity});B=g.eq(n-1).data("pausetime")?g.eq(n-1).data("pausetime"):a.pauseTime;o==null&&q&&F();a.onAfterChange.call(this)},x=function(c,o){t=true;b(".ipresenter-controlNav a.ipresenter-control",d).removeClass("active").eq(c-1).addClass("active");a.onBeforeChange.call(this);k.animate({opacity:0},function(){D(ctx)});var e=g.eq(c-1),f=H(e),m=e.hasClass("active");h=e.data("easing")?C(b.trim(e.data("easing"))):C(a.easing);g.removeClass("active");e.addClass("active");
var j={x:-parseInt(f.rotate.x,10),y:-parseInt(f.rotate.y,10),z:-parseInt(f.rotate.z,10)},q={x:-f.translate.x,y:-f.translate.y,z:-f.translate.z},i=1/parseFloat(f.scale),s=i>=1,r=!m&&!o?a.animSpeed/1E3+"s":"0",p=s?a.animSpeed/2+"ms":"0ms",s=s?"0ms":a.animSpeed/2+"ms",f=f.scale*1E3+"px",i=w(i),j=v(j,true)+u(q);!m&&t&&setTimeout(W,a.animSpeed);if(o){g.css({opacity:a.itemsOpacity});e.css({opacity:1})}else{g.animate({opacity:a.itemsOpacity},a.animSpeed/2);e.animate({opacity:1},a.animSpeed/1.3)}l.css({"-webkit-perspective":f,
"-webkit-transform":i,"-webkit-transition-duration":r,"-webkit-transition-delay":p,"-webkit-transition-timing-function":h,"-moz-perspective":f,"-moz-transform":i,"-moz-transition-duration":r,"-moz-transition-delay":p,"-moz-transition-timing-function":h,"-o-perspective":f,"-o-transform":i,"-o-transition-duration":r,"-o-transition-delay":p,"-o-transition-timing-function":h,"-ms-perspective":f,"-ms-transform":i,"-ms-transition-duration":r,"-ms-transition-delay":p,"-ms-transition-timing-function":h,perspective:f,
transform:i,"transition-duration":r,"transition-delay":p,"transition-timing-function":h});E.css({"-webkit-transform":j,"-webkit-transition-duration":r,"-webkit-transition-delay":s,"-webkit-transition-timing-function":h,"-moz-transform":j,"-moz-transition-duration":r,"-moz-transition-delay":s,"-moz-transition-timing-function":h,"-o-transform":j,"-o-transition-duration":r,"-o-transition-delay":s,"-o-transition-timing-function":h,"-ms-transform":j,"-ms-transition-duration":r,"-ms-transition-delay":s,
"-ms-transition-timing-function":h,transform:j,"transition-duration":r,"transition-delay":s,"transition-timing-function":h});n=c},X=function(){D(ctx);if(i>360){z();y()}},F=function(){o=setInterval(X,B/180)},z=function(){clearInterval(o);o=null;i=0},N=function(){q=true;F();k.removeClass("pause").addClass("play").attr("title",a.pauseLabel);k.css("display","block");D(ctx);a.onPlay.call(this)},O=function(){q=false;clearInterval(o);o=null;k.removeClass("play").addClass("pause").attr("title",a.playLabel);
a.onPause.call(this)},y=function(){if(t)return false;if(n==m){x(1);a.replay||O();a.onLastStep.call(this)}else x(n+1);q&&z()},A=function(){if(t)return false;n==1?x(m):x(n-1);q&&z()};new ImagePreload(j,function(a){a=a*10;M.stop().animate({width:a+"%"})},function(){M.stop().animate({width:"100%"},function(){V.remove();g.show();b("a.ipresenter_stepsNav").show();m>0&&a.autoPlay&&N();a.startStep>1&&x(n,true);a.onAfterLoad.call(this)})});a.pauseOnHover&&d.hover(function(){if(q){clearInterval(o);o=null}},
function(){o==null&&(q&&i<360&&a.autoPlay&&!t)&&F()});b("a#ipresenter_nextStep",d).click(y);b("a#ipresenter_prevStep",d).click(A);b("a.ipresenter-controlPrevNav",d).click(A);b("a.ipresenter-controlNextNav",d).click(y);b(".ipresenter-controlNav a.ipresenter-control",d).click(function(){if(t||b(this).hasClass("active"))return false;n=parseInt(b(this).attr("rel"));x(n);q&&z()});k.click(function(){b(this).hasClass("play")?O():N()});b(".ipresenter_stepsNav",d).css({opacity:a.directionNavHoverOpacity});
d.hover(function(){b(".ipresenter_stepsNav",d).stop().animate({opacity:1},300)},function(){b(".ipresenter_stepsNav",d).stop().animate({opacity:a.directionNavHoverOpacity},300)});b(".ipresenter-controlNav",d).css({opacity:a.controlNavHoverOpacity});d.hover(function(){b(".ipresenter-controlNav",d).stop().animate({opacity:1},300)},function(){b(".ipresenter-controlNav",d).stop().animate({opacity:a.controlNavHoverOpacity},300)});b(".ipresenter-controlNav a.ipresenter-control",d).hover(function(){b(".ipresenter-tooltip",
b(this).parent()).fadeIn()},function(){b(".ipresenter-tooltip",b(this).parent()).fadeOut()});a.touchNav&&navigator.userAgent.match(/ipad|iphone|ipod|android/i)&&d.swipe({swipeLeft:y,swipeRight:A});a.keyboardNav&&b(document).bind("keyup.iPresenter",function(a){switch(a.keyCode){case 33:case 37:case 38:A();break;case 34:case 39:case 40:y()}})};b.fn.swipe=function(a){a=jQuery.extend({threshold:{x:30,y:100},swipeLeft:function(){alert("swiped left")},swipeRight:function(){alert("swiped right")}},a);b(this).each(function(){var l=
b(this),d=0,g=0,m=0,j=0;l.bind("touchstart MozTouchDown",function(a){d=a.originalEvent.targetTouches[0].pageX;g=a.originalEvent.targetTouches[0].pageY;m=d;j=g});l.bind("touchmove MozTouchMove",function(a){a.preventDefault();m=a.originalEvent.touches[0].pageX;j=a.originalEvent.touches[0].pageY});l.bind("touchend MozTouchRelease",function(){var b=g-j;b<a.threshold.y&&b>-1*a.threshold.y&&(changeX=d-m,changeX>a.threshold.x&&a.swipeLeft.call(this),changeX<-1*a.threshold.x&&a.swipeRight.call(this))})})}})(jQuery);
function ImagePreload(b,a,l){this.m_pfnPercent=a;this.m_pfnFinished=l;this.m_nProcessed=this.m_nLoaded=0;this.m_aImages=[];this.m_nICount=b.length;for(a=0;a<b.length;a++)this.Preload(b[a])}ImagePreload.prototype.Preload=function(b){var a=new Image;this.m_aImages.push(a);a.onload=ImagePreload.prototype.OnLoad;a.onerror=ImagePreload.prototype.OnError;a.onabort=ImagePreload.prototype.OnAbort;a.oImagePreload=this;a.bLoaded=!1;a.source=b;a.src=b};
ImagePreload.prototype.OnComplete=function(){this.m_nProcessed++;this.m_nProcessed==this.m_nICount?this.m_pfnFinished():this.m_pfnPercent(Math.round(10*(this.m_nProcessed/this.m_nICount)))};ImagePreload.prototype.OnLoad=function(){this.bLoaded=!0;this.oImagePreload.m_nLoaded++;this.oImagePreload.OnComplete()};ImagePreload.prototype.OnError=function(){this.bError=!0;this.oImagePreload.OnComplete()};ImagePreload.prototype.OnAbort=function(){this.bAbort=!0;this.oImagePreload.OnComplete()};
function disableSelection(b){"undefined"!=typeof b.style.MozUserSelect?b.style.MozUserSelect="none":"undefined"!=typeof b.onselectstart?b.onselectstart=function(){return!1}:b.onmousedown=function(){return!1};b.style.cursor="default"};